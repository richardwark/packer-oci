# Packer Workshop - Using Packer:  Full Docker Developer Image Build

![](images/WorkshopHeader/400.png)

## Introduction

In this lab you build on the concepts of the previous labs, but will add commentary and discussion around more advanced topics.  
 
## Objectives

- Create an image with a desktop (gnome) and software installed (git, docker)
- Learn considerations for ordering of services and dependencies

## Required Artifacts

- Oracle Cloud Account - (configured in Lab100)
- Your Client Image (from lab 200) or packer & git installed locally on your laptop.
- Your git repository with _variables_.json and key file committed.

### **STEP 1**: Inspect the Packer build template: varBuild400.json

In the file varBuild400.json, you will see the components of an example real-world installation:

- In the terminal window, examine varBuild400.json by typing:

```
more varBuild400.json 
```

### **STEP 2**: Validate the Packer build template 

- Run packer validate to make sure our file is valid

```
packer validate -var-file=_variables_.json  varBuild400.json
```

  ![](images/Lab400/2.1.png)

### **STEP 3**: Run Packer Build

Using your varibles file, run a packer build at in the terminal window:

```
packer build -var-file=_variables_.json  varBuild400.json
```
- You can see the build process start running:

   ![](images/Lab400/5.png)

- You will also see the file upload process take place.
  
   ![](images/Lab400/10.png)
 
### **STEP 4**: Launch an Instance of your Custom Image

- Navigate to back to your browser's OCI Console to see your custom image.

- Using the elisipse to the right of the image creation time, select "Create Instance" 

  ![](images/Lab400/11.png)

- **Select** a name for the image (Lab500) and place it in any Availability Domain

  ![](images/Lab400/14.png)

- **Paste** or choose your public key file.

  ![](images/Lab400/13.png)

- Double check the compartment, VCN and subnet  

  ![](images/Lab400/15.png)

- Select **Create**
  
You will see in the "Provisioning", state for a couple of mins as you create the boot volume and instantiate the image.  

- Note the public IP address of your instance, you will connect to this in the next step.

  ![](images/Lab400/12.png)

### **STEP 5**: Connect to Custom Instance

- Using the IP address, Connect using VNC to the server installed on port 5910.  You can use the finder built-in (Mac/Linux) or with Real VNC Viewer(Windows)

  ![](images/Lab400/13.png)

- You should get the VNC Login Window, enter the password you configured in Lab 200:

  ![](images/Lab400/16.png)

- Again, you will start by checking the ImageID you created to track versions.  You should see "varBuild400":

  - Launch a terminal window:

```
more .ImageID
```
  - Launch Terminal 

  ![](images/Lab400/20.png)

You can see that docker is starting normally, so our enabled service should work in the completed image.

### **STEP 5**: Remove API key from your user

To make certain that your environment is secure, you can easily remove the API key you added to your user by **navigating** to Identity --> Users

- Select your user and then the ellipses on the right, and **Delete**  

  ![](images/Lab500/21.png)

You can decide to keep or remove the Instances and custom images created (packer-builder, lab300 & lab400) as you see fit.

The are WAY more topics than can be covered in a single lab. Here are some pointers to resources than can help you learn more.

 Hints:

  - Always protect your keys and OCIDs as they can be used, if stolen by bad-actors, to access resources or attempt to steal data.

  - create variables.json for specific environments (tenants, compartments or subnets) files which can be shared between & across build projects.
  
  - Start small and build up in complexity.

  - Use a JSON lint-like format checker. like: https://jsonlint.com/ or an IDE editor plug-in.

**You are done with the Workshop**